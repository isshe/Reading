[TOC]

# 系统启动过程描述

## 1. bootsect.s
* BIOS自动加载第一个扇区（引导程序）到0x07c0 （？？？疑问怎么开始加载引导程序到内存的？？）
* 从0x07c0开始执行；
* bootsect.s(引导程序)把自己复制到 0x9000
* 跳到`0x9000+偏移`去执行
* 加载`setup.s`程序（从第2扇区开始，读4个扇区）
* 取磁盘驱动器的参数，实际上是取每磁道扇区数
* 打印信息`Loading system ...`
* 加载system模块

## 2. setup.s
### 2.1 步骤
setup.s负责从BIOS中获取系统数据，并将这些数据放到系统内存的适当地方。
* 获取内存大小
* 获取显卡数据(Get video-card data)
    * 获取显示卡当前显示模式
* 检查显示方式（EGA/VGA）并取参数。
* 取第一个硬盘的信息（复制硬盘参数表）。
* 取第二个硬盘的信息（复制硬盘参数表）。
* 检查系统是否有第2个硬盘。如果没有则把第2个表清零。
* 进入保护模式

### 2.2 疑问
* 8Mb - limit=2047 (2048*4096=8Mb)？

## 3. head.s
* head.s已经处于保护模式
* 测试A20地址线是否选通
* 没看懂

### 3.1 步骤
* 设置中断描述符表（idt）
* 设置全局描述符表（gdt）
* 重新装载所有的段寄存器（因为修改了gdt，所以需要重新装载）
* 测试A20地址线是否已经开启，没开就死循环
* 设置页表
* 跳到main()函数中执行(init/main.c)

### 3.2 疑问
* 
